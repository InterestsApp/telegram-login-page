<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–í—Ö–æ–¥ –≤ GO –í–ú–ï–°–¢–ï</title>
    <style>
        body {
            background-color: #f2f2f2;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: sans-serif;
        }
        h2 {
            margin-bottom: 20px;
            color: #333;
        }
        .note {
            margin-top: 20px;
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <h2>GO –í–ú–ï–°–¢–ï</h2>

    <!-- –í–ê–ñ–ù–û: data-onauth —Ç–µ–ø–µ—Ä—å —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –Ω–∞—à—É —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é -->
    <script
        async
        src="https://telegram.org/js/telegram-widget.js?22"
        data-telegram-login="InterestsApp_bot"
        data-size="large"
        data-userpic="false"
        data-request-access="write"
        data-lang="ru"
        data-onauth="handleTelegramLogin(user)">
    </script>

    <div class="note">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –≤—ã—à–µ –¥–ª—è –≤—Ö–æ–¥–∞</div>

    <script>
        // –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø: —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ Telegram
        window.handleTelegramLogin = function(user) {
            console.log("Telegram login success:", user);

            // 1. –ö–æ–¥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–µ–∑–æ–ø–∞—Å–Ω—É—é —Å—Ç—Ä–æ–∫—É base64
            //    (–∏—Å–ø–æ–ª—å–∑—É–µ–º unescape/encodeURIComponent –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∫–∏—Ä–∏–ª–ª–∏—Ü—ã)
            const userJson = JSON.stringify(user);
            const encodedData = btoa(unescape(encodeURIComponent(userJson)));

            // 2. –ü–†–û–í–ï–†–Ø–ï–ú, –≥–¥–µ –º—ã –Ω–∞—Ö–æ–¥–∏–º—Å—è
            //    –ï—Å–ª–∏ –µ—Å—Ç—å –æ–±—ä–µ–∫—Ç Android (–º—ã –≤ WebView –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è) - –≤—ã–∑—ã–≤–∞–µ–º –Ω–∞—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥
            if (window.Android && typeof window.Android.onTelegramLogin === 'function') {
                console.log("Android app detected, calling native method");
                // –í–∞–∂–Ω–æ: –ø–µ—Ä–µ–¥–∞–µ–º —Å—Ç—Ä–æ–∫—É, –∞ –Ω–µ –æ–±—ä–µ–∫—Ç
                Android.onTelegramLogin(userJson);
                return; // –í—ã—Ö–æ–¥–∏–º, –¥–∞–ª—å—à–µ –Ω–µ –∏–¥–µ–º
            }

            // 3. –ï—Å–ª–∏ –º—ã –ù–ï –≤ Android (–∑–Ω–∞—á–∏—Ç, –≤ –æ–±—ã—á–Ω–æ–º –±—Ä–∞—É–∑–µ—Ä–µ) - –î–ï–õ–ê–ï–ú –†–ï–î–ò–†–ï–ö–¢
            console.log("Web browser detected, redirecting...");

            // üëá –ó–î–ï–°–¨ –£–ö–ê–ñ–ò –°–í–û–ô –¢–û–ß–ù–´–ô –ê–î–†–ï–° –ò –ü–û–†–¢ (—Å–µ–π—á–∞—Å 3001)
            const webLoginUrl = 'http://localhost:3001/login';

            // –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π URL —Å –¥–∞–Ω–Ω—ã–º–∏ –≤ —Ö–µ—à–µ
            const redirectUrl = webLoginUrl + '#tgAuthResult=' + encodedData;
            console.log("Redirecting to:", redirectUrl);

            // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é (–∏–ª–∏ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫—É—é) —Å—Ç—Ä–∞–Ω–∏—Ü—É
            if (window.opener && !window.opener.closed) {
                // –ï—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ—Ç–∫—Ä—ã—Ç–∞ –∫–∞–∫ –ø–æ–ø–∞–ø - –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–µ –æ–∫–Ω–æ –∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º—Å—è
                window.opener.location.href = redirectUrl;
                window.close();
            } else {
                // –û–±—ã—á–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –≤ —Ç–µ–∫—É—â–µ–º –æ–∫–Ω–µ
                window.location.href = redirectUrl;
            }
        };

        // –î–æ–±–∞–≤–∏–º –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É –∏ –ø—Ä–æ–≤–µ—Ä–∏–º, –∑–∞–≥—Ä—É–∑–∏–ª—Å—è –ª–∏ –≤–∏–¥–∂–µ—Ç
        console.log("Telegram login page loaded. Widget should appear.");
    </script>
</body>
</html>
